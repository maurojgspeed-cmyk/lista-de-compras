<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MJG Lista de Compras</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --success: #2ecc71;
            --bg: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .container {
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #status {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            height: 20px;
        }

        .btn-mic {
            background-color: var(--accent);
            color: white;
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-mic.active {
            background-color: var(--success);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }

        #lista {
            width: 100%;
            list-style: none;
            padding: 0;
        }

        li {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .delete-btn {
            background: #ffeeee;
            color: #e74c3c;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .clear-all {
            margin-top: 20px;
            background: none;
            border: 1px solid #ccc;
            padding: 8px 15px;
            border-radius: 20px;
            color: #888;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <header>
        <h1 style="margin:0; font-size: 1.5rem;">MJG Compras Voz</h1>
    </header>

    <div class="container">
        <p id="status">Listo para escuchar</p>
        
        <button id="start-btn" class="btn-mic" aria-label="Hablar">ðŸŽ¤</button>

        <ul id="lista"></ul>
        
        <button class="clear-all" onclick="limpiarTodo()">Borrar lista completa</button>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const listaUI = document.getElementById('lista');
        const status = document.getElementById('status');
        
        // --- CARGAR DATOS GUARDADOS ---
        let productos = JSON.parse(localStorage.getItem('comprasMJG')) || [];
        renderizarLista();

        // --- RECONOCIMIENTO DE VOZ ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'es-ES';
            recognition.interimResults = false;

            recognition.onstart = () => {
                startBtn.classList.add('active');
                status.innerText = "Escuchando producto...";
            };

            recognition.onresult = (event) => {
                const texto = event.results[0][0].transcript;
                if(texto.trim() !== "") {
                    agregarProducto(texto);
                }
            };

            recognition.onerror = (event) => {
                status.innerText = "Error: " + event.error;
                startBtn.classList.remove('active');
            };

            recognition.onend = () => {
                startBtn.classList.remove('active');
                status.innerText = "Toca para agregar otro";
            };

            startBtn.addEventListener('click', () => {
                try {
                    recognition.start();
                } catch(e) {
                    console.log("Ya estaba activo");
                }
            });
        } else {
            status.innerText = "MicrÃ³fono no compatible en este navegador";
        }

        // --- FUNCIONES DE LÃ“GICA ---
        function agregarProducto(nombre) {
            productos.push(nombre);
            guardarYRenderizar();
        }

        function eliminarProducto(index) {
            productos.splice(index, 1);
            guardarYRenderizar();
        }

        function limpiarTodo() {
            if(confirm("Â¿Borrar toda la lista?")) {
                productos = [];
                guardarYRenderizar();
            }
        }

        function guardarYRenderizar() {
            localStorage.setItem('comprasMJG', JSON.stringify(productos));
            renderizarLista();
        }

        function renderizarLista() {
            listaUI.innerHTML = "";
            productos.forEach((prod, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${prod}</span>
                    <button class="delete-btn" onclick="eliminarProducto(${index})">âœ•</button>
                `;
                listaUI.appendChild(li);
            });
        }

        // --- SERVICE WORKER ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log(err));
            });
        }
    </script>
</body>
</html>